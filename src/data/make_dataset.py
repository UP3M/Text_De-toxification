# -*- coding: utf-8 -*-
"""make_dataset.ipynb

Automatically generated by Colaboratory.

Original file is located at
    https://colab.research.google.com/drive/108-vJDKGqKQ1AmiGFXzJ4q0MfydrAqKU

##Transform raw data and create a new dataset
as data preprocessing I swap the reference text and score with the translation text and score if the specific data meet the condition reference toxicity score is smaller than  translation toxicity score.
"""

!wget https://github.com/skoltech-nlp/detox/releases/download/emnlp2021/filtered_paranmt.zip

import zipfile

with zipfile.ZipFile("filtered_paranmt.zip", "r") as zip_ref:
    zip_ref.extractall("/content/")

import pandas as pd
data = pd.read_csv('/content/filtered.tsv', sep='\t')

print(data.head())

# Define the condition for swapping
df = data
condition = df['ref_tox'] < df['trn_tox']

# Get the row indices where the condition is met
indices_to_swap = df.index[condition].tolist()

# Create a temporary DataFrame to swap values within rows
temp_df = df.copy()

temp_df.loc[condition, 'reference'] = df.loc[condition, 'translation'].values
temp_df.loc[condition, 'translation'] = df.loc[condition, 'reference'].values
temp_df.loc[condition, 'ref_tox'] = df.loc[condition, 'trn_tox'].values
temp_df.loc[condition, 'trn_tox'] = df.loc[condition, 'ref_tox'].values

# Update the original DataFrame with the swapped values
df = temp_df
print(df.head)

# Save the resulting DataFrame to a new file in TSV format
new_file_path = "interim.tsv"
df.to_csv(new_file_path, sep='\t', index=False)

print("Data with Swapped Values saved to:", new_file_path)